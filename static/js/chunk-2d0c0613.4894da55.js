(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c0613"],{4210:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",[r("el-card",[r("CategorySelector",{attrs:{forbidden:t.isAddOrEditProperty},on:{changeCategory:t.changeCategory}})],1),r("el-card",{staticStyle:{"margin-top":"20px"}},[r("div",{directives:[{name:"show",rawName:"v-show",value:!t.isAddOrEditProperty,expression:"!isAddOrEditProperty"}]},[t.$hasBtn("btn.Attr.add")?r("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.category3Id},on:{click:t.showAddDiv}},[t._v("添加属性")]):t._e(),r("el-table",{staticStyle:{width:"100%"},attrs:{border:"",data:t.attrList}},[r("el-table-column",{attrs:{label:"序号",align:"center",type:"index",width:"80"}}),r("el-table-column",{attrs:{prop:"attrName",label:"属性名称",width:"150"}}),r("el-table-column",{attrs:{prop:"prop",label:"属性值列表",width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return t._l(a.attrValueList,(function(e){return r("el-tag",{key:e.id,attrs:{type:"info"}},[t._v(t._s(e.valueName))])}))}}])}),r("el-table-column",{attrs:{prop:"prop",label:"操作",width:"150"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row;return[t.$hasBtn("btn.Attr.update")?r("MyButton",{attrs:{type:"warning",icon:"el-icon-edit",size:"mini",title:"修改属性"},on:{click:function(e){return t.editProperty(a)}}}):t._e(),r("el-popconfirm",{attrs:{title:"确定删除"+a.attrName+"吗?"},on:{onConfirm:function(e){return t.confirmDelete(a)}}},[t.$hasBtn("btn.Attr.remove")?r("MyButton",{attrs:{slot:"reference",type:"danger",icon:"el-icon-delete",size:"mini",title:"删除属性"},slot:"reference"}):t._e()],1)]}}])})],1)],1),r("div",{directives:[{name:"show",rawName:"v-show",value:t.isAddOrEditProperty,expression:"isAddOrEditProperty"}]},[r("el-form",{ref:"form",attrs:{model:t.attrForm,inline:""}},[r("el-form-item",{attrs:{label:"属性名"}},[r("el-input",{attrs:{placeholder:"请输入属性名"},model:{value:t.attrForm.attrName,callback:function(e){t.$set(t.attrForm,"attrName",e)},expression:"attrForm.attrName"}})],1)],1),r("el-button",{attrs:{type:"primary",icon:"el-icon-plus",disabled:!t.attrForm.attrName},on:{click:t.addProperty}},[t._v("添加属性值")]),r("el-button",{on:{click:function(e){t.isAddOrEditProperty=!1}}},[t._v("取消")]),r("el-table",{staticStyle:{width:"100%",margin:"20px 0"},attrs:{border:"",data:t.attrForm.attrValueList}},[r("el-table-column",{attrs:{label:"序号",align:"center",type:"index",width:"80"}}),r("el-table-column",{attrs:{prop:"attrValueList",label:"属性值名称",width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,i=e.$index;return[a.isEdit?r("el-input",{ref:i,attrs:{placeholder:"请输入名称",size:"mini"},on:{blur:function(e){return t.toShow(a)}},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.toShow(a)}},model:{value:a.valueName,callback:function(e){t.$set(a,"valueName",e)},expression:"row.valueName"}}):r("span",{staticStyle:{display:"block",width:"100%",height:"100%"},on:{click:function(e){return t.toEdit(a,i)}}},[t._v(" "+t._s(a.valueName)+" ")])]}}])}),r("el-table-column",{attrs:{prop:"prop",label:"操作",width:"width"},scopedSlots:t._u([{key:"default",fn:function(e){var a=e.row,i=e.$index;return[r("el-popconfirm",{attrs:{title:"确定删除"+a.valueName+"吗?"},on:{onConfirm:function(e){return t.attrForm.attrValueList.splice(i,1)}}},[r("MyButton",{attrs:{slot:"reference",type:"danger",icon:"el-icon-delete",title:"删除",size:"mini"},slot:"reference"})],1)]}}])})],1),r("el-button",{attrs:{type:"primary",disabled:0===t.attrForm.attrValueList.length},on:{click:t.saveData}},[t._v("保存")]),r("el-button",{on:{click:function(e){t.isAddOrEditProperty=!1}}},[t._v("取消")])],1)])],1)},i=[],n=r("c7eb"),o=r("1da1"),s=(r("4de4"),r("d3b7"),r("498a"),r("159b"),r("0644")),c=r.n(s),l={name:"Attr",updated:function(){console.log("attr-我周期钩子触发了")},data:function(){return{category1Id:"",category2Id:"",category3Id:"",attrList:[],isAddOrEditProperty:!1,attrForm:{attrName:"",attrValueList:[],categoryId:0,categoryLevel:3}}},methods:{saveData:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var r;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r=t.attrForm,r.attrValueList=r.attrValueList.filter((function(t){if(""!==t.valueName)return delete t.isEdit,!0})),0!==r.attrValueList.length){e.next=4;break}return e.abrupt("return");case 4:return e.prev=4,e.next=7,t.$API.attr.addOrUpdate(r);case 7:t.$message.success(r.id?"修改成功!":"添加属性成功"),t.getAttrList(),t.isAddOrEditProperty=!1,e.next=15;break;case 12:e.prev=12,e.t0=e["catch"](4),t.$message.error(r.id?"修改属性失败!"+e.t0:"添加属性失败!"+e.t0);case 15:case"end":return e.stop()}}),e,null,[[4,12]])})))()},confirmDelete:function(t){var e=this;return Object(o["a"])(Object(n["a"])().mark((function r(){return Object(n["a"])().wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("你单击了确定删除"),r.prev=1,r.next=4,e.$API.attr.delete(t.id);case 4:e.$message.success("删除成功!"),e.getAttrList(),r.next=11;break;case 8:r.prev=8,r.t0=r["catch"](1),e.$message.error("删除失败!");case 11:case"end":return r.stop()}}),r,null,[[1,8]])})))()},toShow:function(t){if(t.valueName.trim()){var e=this.attrForm.attrValueList.some((function(e){if(e!==t)return e.valueName===t.valueName}));e?this.$message.info("请不要输入重复的属性值!"):t.isEdit=!1}else this.$message.info("请输入属性值!")},toEdit:function(t,e){var r=this;t.isEdit=!0,this.$nextTick((function(){r.$refs[e].focus()}))},editProperty:function(t){var e=this;this.isAddOrEditProperty=!0,this.attrForm=c()(t),console.log("深克隆后的值",this.attrForm),this.attrForm.attrValueList.forEach((function(t){e.$set(t,"isEdit",!1)}))},addProperty:function(){var t=this;this.attrForm.attrValueList.push({attrId:this.attrForm.id,valueName:"",isEdit:!0}),this.$nextTick((function(){t.$refs[t.attrForm.attrValueList.length-1].focus()}))},changeCategory:function(t){t.category1Id?this.category1Id=t.category1Id:t.category2Id?this.category2Id=t.category2Id:t.category3Id&&(this.category3Id=t.category3Id,this.getAttrList())},getAttrList:function(){var t=this;return Object(o["a"])(Object(n["a"])().mark((function e(){var r,a,i,o;return Object(n["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=t.category1Id,a=t.category2Id,i=t.category3Id,e.next=3,t.$API.attr.getCategoryList(r,a,i);case 3:o=e.sent,200===o.code?t.attrList=o.data:t.$message.error("获取属性列表失败,请重试!");case 5:case"end":return e.stop()}}),e)})))()},showAddDiv:function(){this.isAddOrEditProperty=!0,this.attrForm={attrName:"",attrValueList:[],categoryId:this.category3Id,categoryLevel:3}}}},d=l,u=r("2877"),p=Object(u["a"])(d,a,i,!1,null,"a1609198",null);e["default"]=p.exports}}]);